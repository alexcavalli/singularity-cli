#!/usr/bin/env ruby
require 'singularity'
require 'restclient'

# passes "--help" if no arguments given which will result in the "else" case statement being executed, printing proper usage
ARGV << '--help' if ARGV.empty?

# must be ARGV.shift for the other .shifts in the case statement to align correctly
action = ARGV.shift

case $action
    when "delete"
        unless ARGV.size == 2
            puts "Usage: singularity delete <file>"
            exit
        end
        task_id = ARGV.shift.gsub(/\.\/singularity\//, "").gsub(/\.json/, "")
        begin
          # delete the request
          RestClient.delete "http://singularity.starfleet/singularity/api/requests/request/#{task_id}"
          puts "#{task_id} DELETED"
        rescue
          puts "#{task_id} #{$!.response}"
        end

    when "deploy"
        unless ARGV.size == 3
            puts "Usage: singularity deploy <uri> <release>"
            exit
        end
        Singularity::Deployer.new(ARGV.shift, ARGV.shift).deploy

    else
        puts "Usage:"
        puts "    singularity delete <file>"
        puts "    singularity deploy <uri> <release>" 
        exit
end



